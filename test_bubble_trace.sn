fn bubbleSort(arr) {
    // Create a copy
    let result = []
    for item in arr {
        result.push(item)
    }
    
    let n = len(result)
    log("Starting with: " + result)
    
    // First pass with detailed logging
    let i = 0
    while i < n - 1 {
        log("i=" + i)
        log("  Before check: result=" + result)
        log("  result[" + i + "]=" + result[i])
        log("  result[" + (i+1) + "]=" + result[i+1])
        
        if result[i] > result[i + 1] {
            log("  Need to swap!")
            // Store values FIRST
            let val_at_i = result[i]
            let val_at_i_plus_1 = result[i + 1]
            log("    Stored: val_at_i=" + val_at_i + ", val_at_i_plus_1=" + val_at_i_plus_1)
            
            // Now swap
            result[i] = val_at_i_plus_1
            log("    After setting result[" + i + "]=" + result[i])
            log("    Array now: " + result)
            
            result[i + 1] = val_at_i
            log("    After setting result[" + (i+1) + "]=" + result[i+1])
            log("    Array now: " + result)
        }
        i = i + 1
    }
    
    return result
}

let test = [64, 34, 25]
bubbleSort(test)